# godo-app

Проект для управления мастер-классами с REST API на Spring Boot.

## Технологический стек

### Backend
- **Java 21** - современная версия Java
- **Spring Boot 3.5.7** - фреймворк для создания приложений
- **Spring Data JDBC** - работа с базой данных
- **PostgreSQL** - реляционная база данных
- **Lombok** - уменьшение boilerplate кода (геттеры, сеттеры, конструкторы)
- **Bean Validation** - валидация входных данных
- **JUnit 5** - тестирование с параметризацией и группировкой

### Инструменты разработки
- **Spotless** - автоматическое форматирование кода
- **Docker Compose** - контейнеризация базы данных

## Локальный запуск через Docker Compose

1. Убедитесь, что установлены `Docker` (включает `docker compose`) и Java 21.
2. Поднимите базу данных:
   ```bash
   docker compose up -d
   ```
3. Запустите backend:
   ```bash
   cd backend
   ./gradlew bootRun
   ```
4. Приложение доступно по адресу `http://localhost:8080`, база данных PostgreSQL — на порту `5432`.

5. Если нужно остановить приложение:
   lsof -ti :8080 | xargs kill

### Переменные окружения

Вы можете переопределить значения по умолчанию, экспортировав переменные перед запуском `docker compose`:

```bash
export DB_NAME=mydb
export DB_USER=myuser
export DB_PASSWORD=secret
docker compose up -d
```

Все переменные необязательные, значения по умолчанию: `godo / godo / godo`.

## Архитектура проекта

### Основные компоненты

#### 1. **MasterClass** (Сущность)
- Entity класс с валидацией полей
- Использует Lombok для генерации геттеров/сеттеров
- Аннотации валидации: `@NotBlank`, `@NotNull`, `@Positive`

#### 2. **MasterClassRepository**
- Интерфейс для работы с БД
- Наследуется от `CrudRepository`
- Автоматическая генерация SQL-запросов Spring Data

#### 3. **MasterClassController**
- REST контроллер с эндпоинтами:
  - `GET /api/master-classes` - получить все мастер-классы
  - `POST /api/master-classes` - создать новый мастер-класс
- Использует `@Valid` для автоматической валидации

#### 4. **GlobalExceptionHandler**
- Централизованная обработка ошибок валидации
- Возвращает `400 Bad Request` с детальными сообщениями об ошибках
- Использует `@RestControllerAdvice`

### Валидация данных

Все входящие данные автоматически валидируются:

- **title** - обязательное поле, не может быть пустым
- **description** - обязательное поле, не может быть пустым
- **instructor** - обязательное поле, не может быть пустым
- **durationMinutes** - обязательное поле, должно быть положительным числом
- **price** - обязательное поле, должно быть положительным числом

При ошибках валидации возвращается `400 Bad Request` с JSON объектом, содержащим поля и сообщения об ошибках:

```json
{
  "title": "Название мастер-класса обязательно",
  "price": "Цена должна быть положительным числом"
}
```

## Тестирование

### Запуск тестов

```bash
cd backend
./gradlew test
```

### Структура тестов

Тесты организованы с использованием практик:

- **@Nested** - группировка тестов по функциональности
- **@ParameterizedTest** - параметризованные тесты для проверки различных сценариев
- **@DisplayName** - читаемые названия тестов
- Helper-методы - устранение дублирования кода

#### Группы тестов:

1. **GetAllMasterClassesTests** - тесты получения всех мастер-классов
2. **CreateMasterClassTests** - тесты создания мастер-классов
3. **ValidationTests** - тесты валидации входных данных

### Покрытие тестами

- ✅ Успешные сценарии (GET, POST)
- ✅ Валидация всех полей
- ✅ Граничные случаи (null, пустые строки, отрицательные числа)
- ✅ Автоматическая установка `createdAt`
- ✅ Обработка невалидного JSON

## Инструкция по тестированию API через Postman

## Базовый URL
```
http://localhost:8080
```

## 1. GET запрос - Получить все мастер-классы

**Метод:** `GET`  
**URL:** `http://localhost:8080/api/master-classes`


### Ожидаемый результат:
- **Статус:** `200 OK`
- **Тело ответа:** Массив мастер-классов (может быть пустым `[]`)

---

## 2. POST запрос - Создать новый мастер-класс

**Метод:** `POST`  
**URL:** `http://localhost:8080/api/master-classes`

### Примеры JSON для запроса:

#### Пример 1: Базовый мастер-класс
```json
{
  "title": "Java для начинающих",
  "description": "Изучите основы Java программирования",
  "instructor": "Иван Иванов",
  "durationMinutes": 120,
  "price": 5000.00
}
```

#### Пример 2: Продвинутый курс
```json
{
  "title": "Spring Boot продвинутый",
  "description": "Углубленное изучение Spring Boot фреймворка",
  "instructor": "Петр Петров",
  "durationMinutes": 180,
  "price": 8000.50
}
```

#### Пример 3: React курс
```json
{
  "title": "React с нуля",
  "description": "Изучите React с нуля до профи",
  "instructor": "Мария Сидорова",
  "durationMinutes": 240,
  "price": 10000.00
}
```

### Ожидаемый результат (успех):
- **Статус:** `201 Created`
- **Тело ответа:** Созданный объект с полями:
  ```json
  {
    "id": 1,
    "title": "Java для начинающих",
    "description": "Изучите основы Java программирования",
    "instructor": "Иван Иванов",
    "durationMinutes": 120,
    "price": 5000.00,
    "createdAt": "2024-01-15T10:30:00"
  }
  ```

### Примеры ошибок валидации:

#### Ошибка: Пустое название
```json
{
  "title": "",
  "description": "Описание",
  "instructor": "Иван",
  "durationMinutes": 120,
  "price": 5000.00
}
```
**Результат:** `400 Bad Request` с сообщением об ошибке валидации

#### Ошибка: Отрицательная цена
```json
{
  "title": "Курс",
  "description": "Описание",
  "instructor": "Иван",
  "durationMinutes": 120,
  "price": -1000.00
}
```
**Результат:** `400 Bad Request` - "Цена должна быть положительным числом"

#### Ошибка: Отсутствует обязательное поле
```json
{
  "title": "Курс",
  "description": "Описание"
}
```
**Результат:** `400 Bad Request` - ошибки валидации для отсутствующих полей

### Формат ответа при ошибках валидации:

При отправке невалидных данных, API возвращает `400 Bad Request` с детальным описанием ошибок:

```json
{
  "title": "Название мастер-класса обязательно",
  "description": "Описание обязательно",
  "instructor": "Имя инструктора обязательно",
  "durationMinutes": "Длительность обязательна",
  "price": "Цена должна быть положительным числом"
}
```

## Работа с базой данных

### Подключение через DataGrip или другие инструменты

**Параметры подключения:**
- **Host:** `localhost`
- **Port:** `5432`
- **Database:** `godo`
- **Username:** `godo`
- **Password:** `godo`

### Структура таблицы `master_classes`

```sql
CREATE TABLE master_classes (
    id BIGSERIAL PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    instructor VARCHAR(255),
    duration_minutes INTEGER,
    price DECIMAL(10, 2),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

```

## Особенности реализации

### Lombok

Проект использует Lombok для уменьшения boilerplate кода:

- `@Getter` / `@Setter` - автоматическая генерация геттеров и сеттеров
- `@NoArgsConstructor` - конструктор без параметров
- `@RequiredArgsConstructor` - конструктор для final полей

### Валидация

Валидация реализована через Bean Validation (Jakarta Validation):

- Автоматическая валидация при использовании `@Valid` в контроллере
- Кастомные сообщения об ошибках на русском языке
- Централизованная обработка через `GlobalExceptionHandler`

### Тестирование

Тесты написаны с использованием современных практик:

- Интеграционные тесты с реальной БД
- Параметризованные тесты для проверки множества сценариев
- Группировка тестов для лучшей читаемости
- Helper-методы для устранения дублирования